<template>
  <Layout>
    <div id="skill-tree-canvas"></div>
  </Layout>
</template>

<script lang="ts">
import Component from "vue-class-component";
import Vue from "vue";
import Layout from "@/components/Layout.vue";
import { select, event } from "d3-selection";
import { drag } from "d3-drag";
import {
  forceSimulation,
  forceLink,
  forceManyBody,
  forceCenter
} from "d3-force";
import { zoom } from "d3-zoom";
import link from "vue-router/src/components/link";

const userIcon = ` <path d="m52.577 14.952c1.9095 3.3073 1.9095 26.069 0 29.375-1.9095 3.3069-21.623 14.688-25.441 14.688-3.8189 0-23.532-11.381-25.441-14.688-1.9095-3.3073-1.9095-26.069 0-29.375 1.9095-3.3073 21.623-14.688 25.441-14.688 3.8189 0 23.532 11.381 25.441 14.688z" fill="#2b3238" stroke-width=".1248" style="paint-order:stroke fill markers"/>
<path transform="matrix(.26458 0 0 .26458 -.00010697 0)" d="m173.31 36.279c0.14637 0.40649 0.29496 0.81219 0.43164 1.2227 2.7906 2.6045-24.408 122.52-170.42 100.16-0.67708-2.0458-1.3096-4.0594-1.9219-6.0586 0.71188 16.992 2.3729 31.373 5.0059 35.934 7.2153 12.499 81.724 55.516 96.158 55.516 14.431 0 88.941-43.017 96.158-55.516 7.2172-12.495 7.2172-98.525 0-111.03-2.4314-4.2119-12.572-11.906-25.412-20.234z" fill="#161a1d" stroke-width=".4717" style="paint-order:stroke fill markers"/>
<path  d="m27.344 18.075c-3.9819 0-7.2125 3.2306-7.2125 7.2125 0 3.9819 3.2306 7.2125 7.2125 7.2125s7.2125-3.2306 7.2125-7.2125c0-3.9819-3.2306-7.2125-7.2125-7.2125zm0 10.819c-1.9909 0-3.6062-1.6153-3.6062-3.6062 0-1.9909 1.6153-3.6062 3.6062-3.6062 1.9909 0 3.6062 1.6153 3.6062 3.6062 0 1.9909-1.6153 3.6062-3.6062 3.6062zm0-18.031c-10.293 0-18.632 8.3394-18.632 18.632 0 10.293 8.3394 18.632 18.632 18.632s18.632-8.3394 18.632-18.632c0-10.293-8.3394-18.632-18.632-18.632zm0 33.658c-3.734 0-7.1449-1.3749-9.7744-3.6363 1.1194-1.728 3.0353-2.9 5.2291-2.9676 1.5627 0.48083 3.0503 0.72125 4.5454 0.72125 1.4951 0 2.9827-0.2329 4.5454-0.72125 2.1938 0.07513 4.1096 1.2396 5.2291 2.9676-2.6296 2.2614-6.0405 3.6363-9.7744 3.6363zm12.224-6.3184c-1.8332-2.3591-4.6656-3.8993-7.8962-3.8993-0.76633 0-1.9534 0.72125-4.3275 0.72125-2.3666 0-3.5612-0.72125-4.3275-0.72125-3.2231 0-6.0555 1.5402-7.8962 3.8993-1.758-2.4568-2.8024-5.462-2.8024-8.7076 0-8.2868 6.7392-15.026 15.026-15.026 8.2868 0 15.026 6.7392 15.026 15.026 0 3.2456-1.0443 6.2508-2.8024 8.7076z" stroke-width="0" fill="#fff"/>
</svg>
`;
const mobileIcon = ` <path d="m52.577 14.952c1.9095 3.3073 1.9095 26.069 0 29.375-1.9095 3.3069-21.623 14.688-25.441 14.688-3.8189 0-23.532-11.381-25.441-14.688-1.9095-3.3073-1.9095-26.069 0-29.375 1.9095-3.3073 21.623-14.688 25.441-14.688 3.8189 0 23.532 11.381 25.441 14.688z" fill="#2b3238" stroke-width=".1248" style="paint-order:stroke fill markers"/>
<path transform="matrix(.26458 0 0 .26458 -.00010697 0)" d="m173.31 36.279c0.14637 0.40649 0.29496 0.81219 0.43164 1.2227 2.7906 2.6045-24.408 122.52-170.42 100.16-0.67708-2.0458-1.3096-4.0594-1.9219-6.0586 0.71188 16.992 2.3729 31.373 5.0059 35.934 7.2153 12.499 81.724 55.516 96.158 55.516 14.431 0 88.941-43.017 96.158-55.516 7.2172-12.495 7.2172-98.525 0-111.03-2.4314-4.2119-12.572-11.906-25.412-20.234z" fill="#161a1d" stroke-width=".4717" style="paint-order:stroke fill markers"/>
<path class="" d="m34.701 12.353h-15.127c-1.7896 0-3.2415 1.4519-3.2415 3.2415v28.093c0 1.7896 1.4519 3.2415 3.2415 3.2415h15.127c1.7896 0 3.2415-1.4519 3.2415-3.2415v-28.093c0-1.7896-1.4519-3.2415-3.2415-3.2415zm-7.5634 32.415c-1.1953 0-2.161-0.96569-2.161-2.161 0-1.1953 0.96569-2.161 2.161-2.161s2.161 0.96569 2.161 2.161c0 1.1953-0.96569 2.161-2.161 2.161z" fill="none" stroke="#fff" stroke-width="1.2316"/>`;
const mlIcon = `<g>
<path d="m52.577 14.952c1.9095 3.3073 1.9095 26.069 0 29.375-1.9095 3.3069-21.623 14.688-25.441 14.688-3.8189 0-23.532-11.381-25.441-14.688-1.9095-3.3073-1.9095-26.069 0-29.375 1.9095-3.3073 21.623-14.688 25.441-14.688 3.8189 0 23.532 11.381 25.441 14.688z" fill="#2b382d" stroke-width=".1248" style="paint-order:stroke fill markers"/>
<path transform="matrix(.26458 0 0 .26458 -.00010697 0)" d="m173.31 36.279c0.14637 0.40649 0.29496 0.81219 0.43164 1.2227 2.7906 2.6045-24.408 122.52-170.42 100.16-0.67708-2.0458-1.3096-4.0594-1.9219-6.0586 0.71188 16.992 2.3729 31.373 5.0059 35.934 7.2153 12.499 81.724 55.516 96.158 55.516 14.431 0 88.941-43.017 96.158-55.516 7.2172-12.495 7.2172-98.525 0-111.03-2.4314-4.2119-12.572-11.906-25.412-20.234z" fill="#212e26" stroke-width=".4717" style="paint-order:stroke fill markers"/>
<path id="Selection" d="m32.444 9.8449 7.036 4.1836c0.63514 0.38603 2.2667 1.2304 2.6071 1.8122 0.39554 0.67508 0.24341 3.5732 0.24531 4.5012 0 0.44688-0.04184 1.0706 0.19396 1.4585 0.52675 0.86904 3.8052 2.0519 4.3376 2.9551 0.22439 0.38223 0.21679 0.86144 0.22249 1.2912v7.036c0 0.51344 0.04184 1.2208-0.22249 1.6715-0.50013 0.84813-3.6017 2.0385-4.2273 2.803-0.50964 0.62183-0.29285 3.7101-0.30426 4.6533-0.02662 2.0804-0.95272 2.126-2.6623 3.1567l-4.5639 2.7764c-0.55528 0.33659-2.1431 1.4072-2.6623 1.5213-0.64465 0.14072-1.1828-0.25672-1.7115-0.57049-0.55908-0.33279-2.7935-1.7419-3.2328-1.8465-0.63514-0.15023-1.1942 0.28334-1.7115 0.59141-0.5876 0.3499-2.7402 1.7172-3.2328 1.8256-0.86524 0.19016-2.3029-0.95272-3.0426-1.4053l-4.9442-3.0065c-0.5838-0.3499-1.9054-1.0326-2.2268-1.5841-0.26433-0.45069-0.24341-1.1372-0.24531-1.6487v-3.2328c-0.0076-0.36511 0.0019-0.75495-0.19397-1.0782-0.48682-0.80249-3.6302-2.0347-4.2292-2.7992-0.39174-0.49823-0.32898-1.2265-0.33088-1.8275v-5.7049c0-0.66177-0.09508-2.0823 0.22249-2.6223 0.53246-0.90327 3.8109-2.0861 4.3376-2.9551 0.2358-0.38793 0.19397-1.0117 0.19397-1.4585 0.0019-0.92799-0.15023-3.8261 0.24531-4.5012 0.33088-0.56478 1.8084-1.3311 2.417-1.6982l4.7541-2.8924c0.53055-0.32518 1.9568-1.2912 2.4721-1.4053 0.64465-0.14072 1.1828 0.25672 1.7115 0.57049 0.55908 0.33278 2.7935 1.7419 3.2328 1.8465 0.63514 0.15023 1.1942-0.28334 1.7115-0.59141 1.0212-0.60852 2.6376-1.8902 3.8033-1.8256zm-18.826 8.7855c0.47921 0 1.8351 0.05515 2.2116-0.10839 0.49252-0.21298 1.3901-1.6639 2.9228-1.082 2.166 0.8215 1.7666 3.7804-0.38033 4.1513-1.2285 0.21108-1.9929-0.95081-2.5254-1.2456-0.50583-0.27954-1.6297-0.19397-2.2287-0.19397 0 0.84812 0.17875 2.1298-0.43928 2.7783-0.68839 0.72262-3.6815 1.9302-4.1208 2.6204-0.21869 0.3461-0.19206 0.85954-0.19396 1.257v6.2754c0.73403-0.20918 2.4588-1.0212 2.9304-1.5955 0.42596-0.51914 0.37082-1.9092 1.8237-2.4474 1.6107-0.59711 3.8641 1.5784 2.2078 3.4476-1.2361 1.3939-2.4949 0.36701-3.3488 0.51914-0.59521 0.10459-2.1108 1.0478-2.6623 1.4072 0.95272 0.86524 2.9913 1.6392 3.499 2.3219 0.50774 0.68078 0.30236 3.7329 0.30426 4.7141 0 0.42596-0.04564 1.0573 0.18826 1.4205 0.24721 0.38223 1.1144 0.84432 1.5232 1.0896l2.8524 1.7495c0.66367 0.40124 3.4534 2.1983 3.9934 2.2477 0.57239 0.05325 1.4129-0.54767 1.9016-0.84052 0.51914-0.31187 1.9967-1.1048 2.2781-1.5555 0.32708-0.52485 0.19397-3.1605 0.19397-3.9212-0.67698 0-3.1016-0.07607-3.5808 0.1122-0.67698 0.26623-1.5327 1.6525-3.0749 1.0269-2.5349-1.0269-1.1372-4.1018 0.76065-4.1018 1.0649 0 1.6544 1.063 2.3143 1.3273 0.4678 0.18826 2.9133 0.1141 3.5808 0.1141v-9.318l0.19397-1.2912 1.5175-1.1429 3.2328-1.9397 0.57049 1.5213c-0.76826 0.24341-3.6017 1.7324-3.9896 2.3542-0.19777 0.31567-0.18636 0.70931-0.19397 1.0687-0.0076 0.44878-0.04184 1.6886 0.1141 2.0519 0.33659 0.78157 2.4892 1.7761 3.3088 1.9416 0-0.91088-0.21488-2.4474 0.43928-3.1339 0.8158-0.85573 3.6511-2.1621 4.1208-2.9856 0.19397-0.34229 0.18636-0.72832 0.19397-1.1067 0.0095-0.57619 0.08557-2.1488-0.19397-2.5881-0.43167-0.67508-3.6473-1.9568-4.2558-2.7764-0.50773-0.68268-0.30426-3.9059-0.30426-4.9043h1.3311v2.4721c0.0038 1.7932 0.09889 1.6449 2.4721 2.9894 0.47921 0.27193 1.1524 0.72832 1.7115 0.6979 0.60852-0.03423 3.4933-1.6886 3.7994-2.2059 0.2339-0.39744 0.19397-1.0288 0.19397-1.4814 0.0019-0.62373 0.07416-3.1358-0.10839-3.5503-0.14262-0.32328-0.38223-0.47731-0.66177-0.66937-0.72262-0.49062-1.6335-1.0326-2.4626-1.295v4.3737h-1.5213v-4.3737c-0.02853-1.489-0.696-1.5574-1.9016-2.282-0.43737-0.26242-1.4433-0.95081-1.9016-0.99265-0.57239-0.05324-1.4129 0.54767-1.9016 0.84052-2.4018 1.4414-2.4683 1.2227-2.4721 3.0046v6.4655c0 0.4697 0.03803 1.0839-0.19397 1.5023-0.51154 0.92229-3.6968 2.1355-4.4498 2.9875-0.53055 0.59901-0.38413 2.1184-2.0119 2.7326-1.1467 0.43167-2.4265-0.60092-2.6832-1.7077-0.25292-1.0972 0.68839-2.2496 1.7324-2.493 0.80249-0.18446 1.2304 0.27764 1.9016 0.17495 0.48492-0.07226 1.4509-0.68459 1.9016-0.95272 1.8598-1.1067 2.4607-1.0174 2.4721-2.8144v-5.895c-0.0038-1.7818-0.07036-1.5631-2.4721-3.0046-0.48872-0.29285-1.3292-0.89376-1.9016-0.84052-0.45829 0.04184-1.4643 0.73022-1.9016 0.99265l-4.3737 2.6623c-0.48492 0.29095-1.8218 1.0117-2.0937 1.4319-0.26623 0.41265-0.18826 1.4814-0.18826 1.991zm4.3832 0.19587c-0.96222 0.4621-0.50774 1.2056 0 1.2056 0.57049 0 1.1086-0.95842 0-1.2056zm23.951 12.925-0.76065 1.3311-4.3737-2.2991-1.9016 0.96793-2.088 1.5612-0.19397 2.0519 0.18826 1.025s1.333 0.95272 1.333 0.95272l3.4229 1.8256-0.57049 1.3311-9.1278-4.9442v7.036s0.19397 2.9703 0.19397 2.9703l1.8978 1.3273 2.282 1.0687 3.2328-1.7533c-0.7055-0.80058-2.3999-1.7685-3.4229-2.0918l0.57049-1.5213 4.1836 2.2934c0.68649 0.15403 1.3406-0.36131 1.9016-0.696 0.46019-0.27574 1.6392-0.90898 1.9035-1.3178 0.31377-0.48492 0.19206-3.1662 0.18826-3.8926-0.0038-0.41646 0.02092-0.92229-0.19397-1.2912-0.38032-0.65226-3.0255-2.0766-3.7994-2.3219 0.14833-0.31757 0.32138-0.79298 0.64465-0.97553 0.42216-0.2377 0.89376 0.08557 1.257 0.29285 0.73213 0.41646 2.2268 1.5726 3.0426 1.4034 0.50583-0.10649 3.3488-1.7153 3.6093-2.126 0.2358-0.37272 0.19397-1.0136 0.19397-1.4471 0.0019-0.55147 0.08177-1.7666-0.19397-2.2097-0.41075-0.65796-3.1909-2.1203-3.9896-2.3542 1.0991-2.3732 1.7172-0.20728 4.1836 0.38032v-1.7115c-0.03042-1.624-1.1676-1.8142-2.4721-2.5292-0.48682-0.26813-1.1448-0.74354-1.7115-0.68649-0.68839 0.06846-3.4305 1.6525-3.6892 2.2839-0.16544 0.40695-0.1141 1.7571-0.1141 2.2629 0 0.40885-0.04944 1.0573 0.18826 1.4015 0.21108 0.30426 0.99265 0.71691 1.333 0.90708l2.8524 1.4947zm-21.304-5.3512c-1.1239 0.33469-0.55908 1.238 0 1.238 0.5857 0 1.082-0.90898 0-1.238zm-6.2887 4.1608c-1.0307 0.04564-0.80249 0.88426-0.31947 1.0649 0.57049 0.21488 1.2912-0.44118 0.31947-1.0649zm6.4598 9.6983c-1.1562 0.04944-0.90898 1.0497-0.33659 1.198 0.54577 0.13882 1.2931-0.5819 0.33659-1.198z" fill="#fff" stroke="#fff" stroke-width=".79876"/>
</g>`;
const webIcon = `<path d="m52.577 14.952c1.9095 3.3073 1.9095 26.069 0 29.375-1.9095 3.3069-21.623 14.688-25.441 14.688-3.8189 0-23.532-11.381-25.441-14.688-1.9095-3.3073-1.9095-26.069 0-29.375 1.9095-3.3073 21.623-14.688 25.441-14.688 3.8189 0 23.532 11.381 25.441 14.688z" fill="#2b3238" stroke-width=".1248" style="paint-order:stroke fill markers"/>
<path transform="matrix(.26458 0 0 .26458 -.00010697 0)" d="m173.31 36.279c0.14637 0.40649 0.29496 0.81219 0.43164 1.2227 2.7906 2.6045-24.408 122.52-170.42 100.16-0.67708-2.0458-1.3096-4.0594-1.9219-6.0586 0.71188 16.992 2.3729 31.373 5.0059 35.934 7.2153 12.499 81.724 55.516 96.158 55.516 14.431 0 88.941-43.017 96.158-55.516 7.2172-12.495 7.2172-98.525 0-111.03-2.4314-4.2119-12.572-11.906-25.412-20.234z" fill="#161a1d" stroke-width=".4717" style="paint-order:stroke fill markers"/>
<path d="m27.128 10.082c-11.08 0-20.061 8.9817-20.061 20.061 0 11.08 8.9817 20.061 20.061 20.061 11.08 0 20.061-8.9817 20.061-20.061 0-11.08-8.9818-20.061-20.061-20.061zm-17.49 21.315h4.3023c0.09572 2.0817 0.41032 3.9863 0.89891 5.6968h-3.823c-0.76552-1.7675-1.2351-3.6869-1.3782-5.6968zm23.679-2.5077c-0.09433-2.0154-0.33326-3.9244-0.6567-5.6968h4.1099c0.54706 1.6822 0.92258 3.5791 1.0358 5.6968zm-9.351 8.2044c-0.3539-1.954-0.52757-3.8613-0.55975-5.6968h7.4442c-0.0321 1.8355-0.20585 3.7428-0.55983 5.6968zm5.7783 2.5077c-0.58792 2.2569-1.4389 4.5576-2.6162 6.8633-1.1772-2.3057-2.028-4.6063-2.6158-6.8633zm-6.3039-10.712c0.09932-2.0269 0.35562-3.9369 0.69592-5.6968h5.984c0.34039 1.7598 0.5966 3.6698 0.69601 5.6968zm1.2594-8.2044c0.78362-3.0591 1.7518-5.4727 2.4283-6.9587 0.6766 1.486 1.6449 3.8996 2.4286 6.9587zm7.4291 0c-0.8-3.3152-1.8272-5.9783-2.5897-7.6995 0.94763 0.67431 4.096 3.1667 6.2436 7.6995zm-7.4118-7.6996c-0.7625 1.7212-1.7896 4.3843-2.5895 7.6996h-3.6543c2.1479-4.5332 5.2964-7.0256 6.2437-7.6996zm-3.1208 10.207c-0.32344 1.7724-0.56229 3.6814-0.65662 5.6968h-4.4895c0.11324-2.1176 0.48868-4.0146 1.0358-5.6968zm-7.6531 5.6967h-4.305c0.14305-2.0098 0.61257-3.9291 1.3781-5.6968h3.8405c-0.4922 1.7102-0.81302 3.6135-0.91357 5.6968zm2.5057 2.5077h4.4564c0.02849 1.8386 0.18317 3.7434 0.51103 5.6968h-3.929c-0.55173-1.6865-0.92847-3.584-1.0384-5.6968zm5.4867 8.2044c0.6151 2.5534 1.5288 5.1631 2.8449 7.7832-0.88818-0.6359-4.1169-3.1756-6.3061-7.7832zm7.5374 7.7889c1.3178-2.6221 2.2323-5.2336 2.848-7.7889h3.4862c-2.1826 4.6311-5.4252 7.1498-6.3341 7.7889zm3.3674-10.297c0.32794-1.9534 0.48262-3.8582 0.51103-5.6968h4.4572c-0.10784 2.1166-0.47852 4.0136-1.0221 5.6968zm7.4753-5.6968h4.3028c-0.14313 2.0098-0.61265 3.9292-1.3782 5.6968h-3.8234c0.4886-1.7105 0.80311-3.6151 0.89883-5.6968zm-0.0025-2.5077c-0.10053-2.0834-0.42135-3.9866-0.91354-5.6968h3.841c0.76561 1.7676 1.235 3.6869 1.3781 5.6968zm1.5795-8.2044h-3.3772c-1.1209-2.7-2.5822-4.8358-3.9573-6.4226 3.0081 1.4133 5.55 3.6471 7.3343 6.4226zm-22.195-6.4222c-1.375 1.5867-2.8361 3.7225-3.9569 6.4222h-3.3768c1.7841-2.7753 4.3258-5.0089 7.3335-6.4222zm-7.3336 25.339h3.3561c1.1039 2.6724 2.5446 4.8011 3.9101 6.3897-2.9782-1.4151-5.4954-3.6353-7.2662-6.3897zm22.263 6.3893c1.3652-1.5884 2.8056-3.7171 3.9093-6.3893h3.3564c-1.7706 2.7542-4.2876 4.9742-7.2656 6.3893z" fill="none" stroke="#fff" stroke-width=".82257"/>`;

const machineLearningId = "Machine Learning";

const pyTorchId = "Pytorch";
const swtfId = "Swift for TensorFlow";

const pythonId = "Python";
const swiftId = "Swift";

const mlNodes = [
  {
    id: pythonId,
    group: 1,
    icon: mlIcon
  },

  {
    id: pyTorchId,
    group: 1,
    icon: mlIcon
  },

  {
    id: swiftId,
    group: 1,
    icon: mlIcon
  },

  {
    id: swtfId,
    group: 1,
    icon: mlIcon
  }
];

const mlLinks = [
  { source: pyTorchId, target: machineLearningId, value: 1, distance: 10 },
  { source: swtfId, target: machineLearningId, value: 1, distance: 10 },
  { source: swiftId, target: swtfId, value: 1, distance: 10 },
  { source: pythonId, target: pyTorchId, value: 1, distance: 10 }
];
const mobileDevId = "Mobile Development";
const iosId = "iOS";
const androidId = "Android";
const rnId = "React Native";
const kotlinId = "Kotlin";
const javaId = "Java";
const ocId = "Objective-C";

const mobileNodes = [
  {
    id: iosId,
    group: 1,
    icon: mobileIcon
  },
  {
    id: androidId,
    group: 1,
    icon: mobileIcon
  },
  {
    id: rnId,
    group: 1,
    icon: mobileIcon
  },
  {
    id: javaId,
    group: 1,
    icon: mobileIcon
  },
  {
    id: kotlinId,
    group: 1,
    icon: mobileIcon
  },
  {
    id: ocId,
    group: 1,
    icon: mobileIcon
  }
];

const mobileLinks = [
  { source: androidId, target: mobileDevId, value: 1, distance: 10 },
  { source: iosId, target: mobileDevId, value: 1, distance: 10 },
  { source: rnId, target: mobileDevId, value: 1, distance: 100 },
  { source: kotlinId, target: androidId, value: 1, distance: 10 },
  { source: javaId, target: androidId, value: 1, distance: 10 },
  { source: ocId, target: iosId, value: 1, distance: 10 }
];

const webDevId = "Web Development";
const alexId = "Alex Simons";
@Component({
  components: { Layout }
})
export default class Banner extends Vue {
  private nodes = [
    {
      id: alexId,
      group: 1,
      icon: userIcon
    },
    {
      id: mobileDevId,
      group: 1,
      icon: mobileIcon,
      children: {
        nodes: mobileNodes,
        links: mobileLinks
      }
    },
    {
      id: webDevId,
      group: 1,
      icon: webIcon
    },
    {
      id: machineLearningId,
      group: 1,
      icon: mlIcon,
      children: {
        nodes: mlNodes,
        links: mlLinks
      }
    }
  ];
  private links = [
    { source: mobileDevId, target: alexId, value: 1 },
    { source: machineLearningId, target: alexId, value: 8 },
    { source: webDevId, target: alexId, value: 1 }
  ];

  private expandedNodes = {};
  private drawnNodes = {
    machineLearningId,
    mobileDevId,
    alexId,
    webDevId
  };

  private width = 500;
  private height = 500;

  nodeDrag = simulation => {
    const dragstarted = d => {
      if (!event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    };

    const dragged = d => {
      d.fx = event.x;
      d.fy = event.y;
    };

    const dragended = d => {
      if (!event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
      if (this.addedToTree(d)) {
        this.drawTree();
      }
    };

    return drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended);
  };

  addedToTree(node: any): boolean {
    const nodeId = node.id;
    if (!this.expandedNodes[nodeId]) {
      this.expandedNodes[nodeId] = nodeId;
      if (node.children) {
        this.nodes.push(...node.children.nodes);
        this.links.push(...node.children.links);
        this.drawnNodes = {
          ...this.drawnNodes,
          ...node.children.nodes.reduce((a, n) => {
            a[n.id] = a.id;
            return a;
          }, {})
        };
        return true;
      }
    }
    return false;
  }

  private simulation: any;
  private link: any;
  private node: any;

  mounted() {
    const canvas = select("#skill-tree-canvas");
    const skillTreeSvg = canvas
      .append("svg")
      .attr("class", "skillTree")
      .attr("viewBox", `0 0 ${this.width} ${this.height}`);

    const drawGroup = skillTreeSvg.append("g");
    skillTreeSvg.call(
      zoom().on("zoom", () => {
        drawGroup.attr("transform", event.transform);
      })
    );

    this.simulation = forceSimulation(this.nodes)
      .force(
        "link",
        forceLink(this.links)
          .id(d => d.id)
          .distance(d => d.distance || 150)
      )
      .force("charge", forceManyBody().strength(-1000))
      .force("center", forceCenter(this.width / 2, this.height / 2));

    this.simulation.on("tick", () => {
      this.link
        .attr("x1", d => d.source.x)
        .attr("y1", d => d.source.y)
        .attr("x2", d => d.target.x)
        .attr("y2", d => d.target.y);

      this.node.attr("x", d => d.x - 30).attr("y", d => d.y - 30);
    });

    this.link = drawGroup
      .append("g")
      .attr("stroke", "#999")
      .attr("id", "linkGroup")
      .attr("stroke-opacity", 0.6)
      .selectAll("line");

    this.node = drawGroup
      .append("g")
      .attr("id", "nodeGroup")
      .attr("stroke", "#fff")
      .attr("stroke-width", 1.5)
      .selectAll(".skillNode");

    this.drawTree();
  }

  drawTree() {
    // Apply the general update pattern to the nodes.
    this.node = this.node.data(this.nodes, function(d) {
      return d.id;
    });
    this.node.exit().remove();
    this.node = this.node
      .enter()
      .append("svg")
      .attr("class", "skillNode")
      .html(d => d.icon)
      .merge(this.node)
      .call(this.nodeDrag(this.simulation));

    this.node.append("title").text(d => d.id);
    // Apply the general update pattern to the links.
    this.link = this.link.data(this.links, function(d) {
      return d.source.id + "-" + d.target.id;
    });
    this.link.exit().remove();
    this.link = this.link
      .enter()
      .append("line")
      .merge(this.link);

    // Update and restart the simulation.
    this.simulation.nodes(this.nodes);
    this.simulation.force("link").links(this.links);
    this.simulation.alpha(1).restart();
  }
}
</script>

<style lang="scss">
.skillTree {
  cursor: move;
}
.skillNode {
  cursor: pointer;
}
</style>
